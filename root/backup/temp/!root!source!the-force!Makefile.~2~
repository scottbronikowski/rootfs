#makefile for the-force (emperor + run-sensors + kalman filter + autodrive)

CC = g++
OUTPUTNAME = the-force${D}	

OPENCV_I = `pkg-config opencv --cflags`
IMLIB_I = `imlib2-config --cflags`
INCLUDE = -I../../include $(OPENCV_I) $(IMLIB_I)
OPENCV_L =  `pkg-config opencv --cflags --libs`
IMLIB_L = `imlib2-config --cflags --libs`
LIBS = -L../../lib -L/usr/local/lib -lpthread -lflycapture${D} $(OPENCV_L) $(IMLIB_L) 
CFLAGS = -D__STDC_CONSTANT_MACROS -Wall
OPTFLAGS = -Ofast -march=native -flto #-fwhole-program
OUTDIR = ../../bin
CAMDIR = ../camera
CAMFILES = ${CAMDIR}/toollib-camera.cpp ${CAMDIR}/toollib-camera.h
MOTORDIR = ../motor_control
MOTORFILES = ${MOTORDIR}/motor_control_functions.cpp ${MOTORDIR}/motor_control.h
# IMUDIR = ../razor-imu
# IMUFILES = ${IMUDIR}/razor-imu.cpp ${IMUDIR}/razor-imu.h
# EMPDIR = ../emperor
# EMPFILES = ${EMPDIR}/emperor.cpp ${EMPDIR}/emperor.h

OBJS =	${CAMDIR}/toollib-camera.o \
	${MOTORDIR}/motor_control_functions.o \
	the-force.o
# 	mGPSInfo.o \
# 	mNMEAParser.o \
# 	run-sensors.o
# #${IMUDIR}/razor-imu.o \
# #${EMPDIR}/emperor.o \
# #${MONDIR}/monitor.o \

# log-to-track: log_to_track.cpp 
# 	# g++ `pkg-config --cflags --libs opencv` `pkg-config --cflags opencv`log_to_track.cpp -o log-to-track.out
# 	${CC} ${CFLAGS} ${OPTFLAGS} log_to_track.cpp -o log-to-track.out ${INCLUDE} ${LIBS} ${COMMON_LIBS}


${OUTPUTNAME}: ${OBJS}
	${CC} -o ${OUTPUTNAME} ${OBJS} ${LIBS} ${COMMON_LIBS}
	mv ${OUTPUTNAME} ${OUTDIR}

the-force.o: the-force.cpp the-force.h
	${CC} ${OPTFLAGS} ${CFLAGS} ${INCLUDE} -Wall -c $*.cpp 

# run-sensors.o: run-sensors.cpp run-sensors.h
# 	${CC} ${OPTFLAGS} ${CFLAGS} ${INCLUDE} -Wall -c $*.cpp 
# #	${CC} -g ${INCLUDE} -Wall -c $*.cpp 

# mGPSInfo.o: mGPSInfo.cpp mGPSInfo.h
# 	${CC} ${OPTFLAGS} ${CFLAGS} ${INCLUDE} -Wall -c $*.cpp 

# mNMEAParser.o: mNMEAParser.cpp mNMEAParser.h
# 	${CC} ${OPTFLAGS} ${CFLAGS} ${INCLUDE} -Wall -c $*.cpp 

# # ${EMPDIR}/emperor.o: ${EMPFILES}
# # 	${CC} ${OPTFLAGS} ${CFLAGS} ${INCLUDE} -Wall -c $*.cpp 

${CAMDIR}/toollib-camera.o: ${CAMFILES}
	${CC} ${OPTFLAGS} ${CFLAGS} ${INCLUDE} -Wall -c $*.cpp -o ${CAMDIR}/toollib-camera.o


${MOTORDIR}/motor_control_functions.o: ${MOTORFILES}
	${CC} ${OPTFLAGS} ${CFLAGS} ${INCLUDE} -Wall -c $*.cpp -o ${MOTORDIR}/motor_control_functions.o

# # ${IMUDIR}/razor-imu.o: ${IMUFILES}
# # 	${CC} ${OPTFLAGS} ${CFLAGS} ${INCLUDE} -Wall -c $*.cpp -o ${IMUDIR}/razor-imu.o

# # ${MONDIR}/monitor.o: ${MONFILES}
# # 	${CC} ${OPTFLAGS} ${CFLAGS} ${INCLUDE} -Wall -c $*.cpp

.PHONY: clean

clean:
	rm -f ${OUTDIR}/${OUTPUTNAME} ${OBJS}	@echo "all cleaned up!"
#	rm -f log-to-track.out	@echo "all cleaned up!"
